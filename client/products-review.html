<!doctype html>
<html lang="lo">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤‡∫•‡∫µ‡∫ß‡∫¥‡∫ß | CHAMPA BRAND</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="products-page">

  <header class="header">
    <div class="container header-inner">
      <a class="logo" href="index.html">
        <img class="logo-img" src="images/logo/SVG/Asset 1.svg" alt="CHAMPA BRAND" />
        <span class="logo-text">
          <span class="logo-main">CHAMPA</span>
          <span class="logo-sub">BRAND</span>
        </span>
      </a>
      <nav class="menu" id="menu">
        <a href="index.html">‡∫´‡∫ô‡ªâ‡∫≤‡∫´‡∫º‡∫±‡∫Å</a>
        <a href="products.html">‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤</a>
        <a href="products-review.html" class="active">‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤‡∫•‡∫µ‡∫ß‡∫¥‡∫ß</a>
        <a href="contact.html">‡∫ï‡∫¥‡∫î‡∫ï‡ªç‡ªà</a>
      </nav>
      <div class="header-search" id="headerSearchWrap">
        <input type="search" id="siteSearchInput" class="site-search-input" placeholder="‡∫Ñ‡∫ª‡ªâ‡∫ô‡∫´‡∫≤..." autocomplete="off" aria-label="‡∫Ñ‡∫ª‡ªâ‡∫ô‡∫´‡∫≤" />
        <div class="site-search-results" id="siteSearchResults" hidden></div>
      </div>
      <div class="header-contact">
        <a href="https://wa.me/8562012345678" target="_blank" rel="noopener" class="contact-item" aria-label="WhatsApp">
          <span class="contact-icon contact-icon-wa"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></span>
          <span class="contact-label">WhatsApp</span>
        </a>
        <a href="https://facebook.com" target="_blank" rel="noopener" class="contact-item" aria-label="Facebook">
          <span class="contact-icon contact-icon-fb"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg></span>
          <span class="contact-label">Facebook</span>
        </a>
        <a href="https://tiktok.com" target="_blank" rel="noopener" class="contact-item" aria-label="TikTok">
          <span class="contact-icon contact-icon-tt"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z"/></svg></span>
          <span class="contact-label">TikTok</span>
        </a>
        <a href="/login" class="contact-item header-login">‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö</a>
      </div>
      <button class="hamburger" id="hamburger" aria-label="Open menu">‚ò∞</button>
    </div>
  </header>

  <main class="products-main">
    <div class="products-hero-shape" aria-hidden="true"></div>
    <div class="container">
      <header class="products-header">
        <span class="products-label">‡∫•‡∫µ‡∫ß‡∫¥‡∫ß</span>
        <h1 class="products-title">‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤‡∫•‡∫µ‡∫ß‡∫¥‡∫ß</h1>
      </header>

      <p class="section-sub muted" style="margin-bottom: 28px;">‡∫ú‡∫ª‡∫ô‡∫á‡∫≤‡∫ô‡ªÄ‡∫™‡∫∑‡ªâ‡∫≠‡∫ó‡∫µ‡ªà‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤‡ªÉ‡∫ä‡ªâ‡∫á‡∫≤‡∫ô ‡ªÅ‡∫•‡∫∞‡ªÉ‡∫´‡ªâ‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫î‡∫µ</p>
      <p class="section-sub muted small" style="margin-bottom: 20px; font-size: 13px;">‡∫•‡∫µ‡∫ß‡∫¥‡∫ß‡∫ó‡∫µ‡ªà‡ªÄ‡∫õ‡∫µ‡∫î‡ªÉ‡∫´‡ªâ‡ªÄ‡∫ö‡∫¥‡ªà‡∫á‡ªÅ‡∫°‡ªà‡∫ô‡∫à‡∫≤‡∫Å‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤ ‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫î‡∫≤‡∫ß‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡ªÑ‡∫î‡ªâ‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡∫ä‡∫∑‡ªà‡∫ï‡∫ª‡∫á‡∫Å‡∫±‡∫ô‡ªÄ‡∫ó‡∫ª‡ªà‡∫≤‡∫ô‡∫±‡ªâ‡∫ô</p>

      <!-- ‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡ªÄ‡∫õ‡∫µ‡∫î‡∫à‡∫≤‡∫Å "‡ªÄ‡∫ö‡∫¥‡ªà‡∫á‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î" = ‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫ü‡∏≠‡∏£‡πå‡∏°, ‡ªÉ‡∫´‡ªâ‡∫Å‡∫ª‡∫î‡ªÉ‡∫ô‡∫Æ‡∫π‡∫ö‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÑ‡∫õ‡∫™‡∫ª‡ªà‡∫á‡∫•‡∫µ‡∫ß‡∫¥‡∫ß -->
      <section id="reviewAddEntrySection" class="review-add-entry" style="margin-bottom: 28px; display: none;">
        <a href="products-review.html?add=1" class="review-add-entry-card" style="display: block; max-width: 320px; padding: 24px; background: #fff; border-radius: 16px; border: 2px dashed rgba(0,0,0,.15); text-align: center; text-decoration: none; color: inherit;">
          <span style="font-size: 48px; display: block; margin-bottom: 12px;">üìù</span>
          <strong style="font-size: 18px;">‡∫™‡∫ª‡ªà‡∫á‡∫•‡∫µ‡∫ß‡∫¥‡∫ß ‡ªÅ‡∫•‡∫∞‡ªÉ‡∫´‡ªâ‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫î‡∫µ</strong>
          <p class="muted small" style="margin: 8px 0 0; font-size: 14px;">‡∫Å‡∫ª‡∫î‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫•‡∫µ‡∫ß‡∫¥‡∫ß‡ªÉ‡ªù‡ªà</p>
        </a>
      </section>

      <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏≤‡∏ß (‡ªÄ‡∫õ‡∫µ‡∫î‡ªÄ‡∫°‡∫∑‡ªà‡∫≠ ?add=1) -->
      <section id="reviewFormSection" class="review-submit-section" style="margin-bottom: 32px;">
        <h2 class="section-title" style="font-size: 18px; margin-bottom: 16px;">‡∫™‡∫ª‡ªà‡∫á‡∫•‡∫µ‡∫ß‡∫¥‡∫ß ‡ªÅ‡∫•‡∫∞‡ªÉ‡∫´‡ªâ‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫î‡∫µ</h2>
        <form id="reviewSubmitForm" class="review-submit-form" style="max-width: 480px;">
          <div style="margin-bottom: 14px;">
            <label for="reviewProduct" class="muted" style="display: block; margin-bottom: 6px; font-size: 14px;">‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤‡∫ó‡∫µ‡ªà‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫µ‡∫ß‡∫¥‡∫ß</label>
            <select id="reviewProduct" name="product_id" required style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,.15); font-size: 15px;">
              <option value="">-- ‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤ --</option>
            </select>
          </div>
          <div style="margin-bottom: 14px;">
            <label for="reviewCustomerName" class="muted" style="display: block; margin-bottom: 6px; font-size: 14px;">‡∫ä‡∫∑‡ªà‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤</label>
            <input type="text" id="reviewCustomerName" name="customer_name" required placeholder="‡∫ä‡∫∑‡ªà‡∫Ç‡∫≠‡∫á‡∫ó‡ªà‡∫≤‡∫ô" style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,.15); font-size: 15px;" />
          </div>
          <div style="margin-bottom: 14px;">
            <span class="muted" style="display: block; margin-bottom: 6px; font-size: 14px;">‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫î‡∫≤‡∫ß (1‚Äì5)</span>
            <div class="review-stars-input" id="reviewStarsInput" role="group" aria-label="‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô">
              <button type="button" class="review-star-btn" data-rating="1" aria-label="1 ‡∫î‡∫≤‡∫ß">‚òÜ</button>
              <button type="button" class="review-star-btn" data-rating="2" aria-label="2 ‡∫î‡∫≤‡∫ß">‚òÜ</button>
              <button type="button" class="review-star-btn" data-rating="3" aria-label="3 ‡∫î‡∫≤‡∫ß">‚òÜ</button>
              <button type="button" class="review-star-btn" data-rating="4" aria-label="4 ‡∫î‡∫≤‡∫ß">‚òÜ</button>
              <button type="button" class="review-star-btn" data-rating="5" aria-label="5 ‡∫î‡∫≤‡∫ß">‚òÜ</button>
            </div>
            <input type="hidden" name="rating" id="reviewRating" value="" required />
          </div>
          <div style="margin-bottom: 16px;">
            <label for="reviewComment" class="muted" style="display: block; margin-bottom: 6px; font-size: 14px;">‡ªÄ‡∫´‡∫î‡∫ú‡∫ª‡∫ô (‡∫ö‡ªç‡ªà‡∫ö‡∫±‡∫á‡∫Ñ‡∫±‡∫ö)</label>
            <textarea id="reviewComment" name="comment" rows="3" placeholder="‡∫Ñ‡∫≥‡ªÄ‡∫´‡∫±‡∫ô‡∫´‡∫º‡∫∑‡∫Ñ‡∫ß‡∫≤‡∫°‡∫û‡ªç‡ªÉ‡∫à..." style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,.15); font-size: 15px; resize: vertical;"></textarea>
          </div>
          <button type="submit" class="btn primary" style="padding: 12px 24px;">‡∫™‡∫ª‡ªà‡∫á‡∫•‡∫µ‡∫ß‡∫¥‡∫ß ‡ªÅ‡∫•‡∫∞‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫î‡∫µ</button>
          <p id="reviewSubmitStatus" class="muted small" style="margin-top: 10px;"></p>
        </form>
      </section>

      <div class="products-grid products-grid-work" id="reviewGrid">
        <!-- Reviews ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å API -->
      </div>
    </div>
  </main>

  <!-- Modal ‡ªÄ‡∫ö‡∫¥‡ªà‡∫á/‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô (‡∫Å‡∫ª‡∫î‡∫Æ‡∫π‡∫ö‡ªÉ‡∫ô‡∫Å‡∫≤‡∫î) -->
  <div id="reviewDetailModal" class="review-detail-modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 100; align-items: center; justify-content: center; padding: 20px;">
    <div class="review-detail-modal-backdrop" style="position: absolute; inset: 0;" aria-hidden="true"></div>
    <div class="review-detail-modal-inner" style="position: relative; background: #fff; border-radius: 16px; max-width: 400px; width: 100%; max-height: 90vh; overflow-y: auto;">
      <div style="padding: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h3 style="margin: 0; font-size: 18px;">‡∫•‡∫µ‡∫ß‡∫¥‡∫ß ‚Äì ‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫î‡∫≤‡∫ß</h3>
          <button type="button" id="reviewDetailModalClose" aria-label="‡∫õ‡∫¥‡∫î" style="background: none; border: none; font-size: 24px; cursor: pointer; line-height: 1;">√ó</button>
        </div>
        <div id="reviewDetailImage" style="width: 100%; aspect-ratio: 4/3; background: #eee; border-radius: 12px; overflow: hidden; margin-bottom: 12px;"></div>
        <p id="reviewDetailProduct" style="margin: 0 0 4px; font-weight: 700;"></p>
        <p id="reviewDetailCustomer" class="muted small" style="margin: 0 0 12px;"></p>
        <p class="muted small" style="margin-bottom: 6px;">‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫õ‡∫±‡∫î‡∫à‡∫∏‡∫ö‡∫±‡∫ô: <span id="reviewDetailStars"></span></p>
        <p class="muted small" style="margin-bottom: 8px;">‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô (‡ªÉ‡∫™‡ªà‡∫ä‡∫∑‡ªà‡ªÉ‡∫´‡ªâ‡∫ï‡∫ª‡∫á‡∫Å‡∫±‡∫ô‡∫Å‡∫±‡∫ö‡∫ú‡∫π‡ªâ‡ªÉ‡∫´‡ªâ‡∫•‡∫µ‡∫ß‡∫¥‡∫ß):</p>
        <div class="review-stars-input" id="reviewDetailStarsInput" style="margin-bottom: 12px;"></div>
        <input type="text" id="reviewDetailNameInput" placeholder="‡∫ä‡∫∑‡ªà‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤ (‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô)" style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,.2); margin-bottom: 12px; box-sizing: border-box;">
        <p id="reviewDetailError" class="muted small" style="margin: 0 0 12px; color: #c00; display: none;"></p>
        <div style="display: flex; gap: 10px;">
          <button type="button" id="reviewDetailSave" class="btn primary" style="padding: 10px 20px;">‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô</button>
          <button type="button" id="reviewDetailCancel" class="btn ghost">‡∫õ‡∫¥‡∫î</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="footer-inner">
        <div>
          <div class="strong">CHAMPA BRAND</div>
          <div class="muted">‡ªÄ‡∫™‡∫∑‡ªâ‡∫≠‡∫û‡∫¥‡∫°‡∫•‡∫≤‡∫ç ‚Ä¢ ‡∫ó‡∫µ‡∫°‡∫ö‡∫≤‡∫ô‡ªÄ‡∫ï‡∫∞ ‚Ä¢ ‡ªÄ‡∫™‡∫∑‡ªâ‡∫≠‡ªÅ‡∫•‡ªà‡∫ô ‚Ä¢ ‡ªÄ‡∫™‡∫∑‡ªâ‡∫≠‡∫ö‡∫≤‡∫™ ‚Ä¢ eSport</div>
        </div>
      </div>
      <div class="footer-copy muted">¬© <span id="year"></span> CHAMPA BRAND</div>
    </div>
  </footer>

  <a class="sticky-consult" href="contact.html" aria-label="‡∫õ‡∫∂‡∫Å‡∫™‡∫≤‡∫ü‡∫£‡∫µ">‡∫õ‡∫∂‡∫Å‡∫™‡∫≤‡∫ü‡∫£‡∫µ</a>

  <script src="script.js"></script>
  <script>
    // ‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡∫Å‡∫ª‡∫î "‡ªÄ‡∫ö‡∫¥‡ªà‡∫á‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î" = ‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫ü‡∏≠‡∏£‡πå‡∏°, ‡ªÉ‡∫´‡ªâ‡∫Å‡∫ª‡∫î‡ªÉ‡∫ô‡∫Æ‡∫π‡∫ö‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÑ‡∫õ‡∫™‡∫ª‡ªà‡∫á‡∫•‡∫µ‡∫ß‡∫¥‡∫ß
    (function toggleFormByUrl() {
      var addSection = document.getElementById("reviewFormSection");
      var entrySection = document.getElementById("reviewAddEntrySection");
      var hasAdd = window.location.search.indexOf("add=1") !== -1;
      if (addSection) addSection.style.display = hasAdd ? "block" : "none";
      if (entrySection) entrySection.style.display = hasAdd ? "none" : "block";
    })();

    // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏≤‡∏ß ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÉ‡∏´‡πâ admin
    (function setupReviewForm() {
      const form = document.getElementById("reviewSubmitForm");
      const productSelect = document.getElementById("reviewProduct");
      const ratingInput = document.getElementById("reviewRating");
      const statusEl = document.getElementById("reviewSubmitStatus");
      const starBtns = document.querySelectorAll(".review-star-btn");

      if (!form || !productSelect) return;

      // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏™‡πà select
      fetch("/api/products").then(function (r) {
        if (!r.ok) return;
        return r.json();
      }).then(function (products) {
        if (!products || !products.length) return;
        products.forEach(function (p) {
          const opt = document.createElement("option");
          opt.value = p.id;
          opt.textContent = p.name || "Product #" + p.id;
          productSelect.appendChild(opt);
        });
      }).catch(function () {});

      // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏≤‡∏ß 1‚Äì5 (‡∏Å‡∏î‡∏î‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á = ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å)
      function updateStarsDisplay(value) {
        var rating = value ? parseInt(value, 10) : 0;
        starBtns.forEach(function (b, i) {
          b.textContent = i + 1 <= rating ? "‚òÖ" : "‚òÜ";
          b.classList.toggle("active", i + 1 <= rating);
        });
      }
      starBtns.forEach(function (btn) {
        btn.addEventListener("click", function () {
          var rating = parseInt(btn.getAttribute("data-rating"), 10);
          var current = ratingInput.value ? parseInt(ratingInput.value, 10) : 0;
          if (current === rating) {
            ratingInput.value = "";
            updateStarsDisplay(0);
          } else {
            ratingInput.value = rating;
            updateStarsDisplay(rating);
          }
        });
      });

      form.addEventListener("submit", function (e) {
        e.preventDefault();
        if (!ratingInput.value || ratingInput.value < 1 || ratingInput.value > 5) {
          if (statusEl) { statusEl.textContent = "‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫î‡∫≤‡∫ß 1‚Äì5"; statusEl.style.color = "#c00"; }
          return;
        }
        var payload = {
          product_id: parseInt(productSelect.value, 10),
          customer_name: (document.getElementById("reviewCustomerName") && document.getElementById("reviewCustomerName").value) || "",
          rating: parseInt(ratingInput.value, 10),
          comment: (document.getElementById("reviewComment") && document.getElementById("reviewComment").value) || null
        };
        if (statusEl) statusEl.textContent = "‡∫Å‡∫≥‡∫•‡∫±‡∫á‡∫™‡∫ª‡ªà‡∫á...";
        fetch("/api/reviews", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        }).then(function (res) {
          return res.json().then(function (data) {
            if (res.ok) {
              if (statusEl) { statusEl.textContent = "‡∫™‡∫ª‡ªà‡∫á‡∫•‡∫µ‡∫ß‡∫¥‡∫ß‡ªÅ‡∫•‡∫∞‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫î‡∫µ‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î ‡∫ó‡∫µ‡∫°‡∫á‡∫≤‡∫ô‡∫à‡∫∞‡ªÄ‡∫ö‡∫¥‡ªà‡∫á‡ªÑ‡∫î‡ªâ"; statusEl.style.color = "#0a0"; }
              form.reset();
              ratingInput.value = "";
              starBtns.forEach(function (b) { b.textContent = "‚òÜ"; b.classList.remove("active"); });
              window.loadReviewList && window.loadReviewList();
            } else {
              if (statusEl) { statusEl.textContent = data.error || "‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î"; statusEl.style.color = "#c00"; }
            }
          });
        }).catch(function () {
          if (statusEl) { statusEl.textContent = "‡ªÄ‡∫ä‡∫∑‡ªà‡∫≠‡∫°‡∫ï‡ªç‡ªà‡∫•‡∫ª‡ªâ‡∫°‡ªÄ‡∫´‡∫º‡∫ß"; statusEl.style.color = "#c00"; }
        });
      });
    })();

    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ products-review.html
    window.loadReviewList = async function loadReviewList() {
      const reviewGrid = document.getElementById("reviewGrid");
      if (!reviewGrid) return;
      try {
        const r = await fetch("/api/reviews");
        if (r.ok) {
          const reviews = await r.json();
          const productsR = await fetch("/api/products");
          const products = productsR.ok ? await productsR.json() : [];
          if (reviews.length === 0) {
            reviewGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: #666; padding: 40px 0;">‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫•‡∫µ‡∫ß‡∫¥‡∫ß</div>';
            return;
          }
          reviewGrid.innerHTML = "";
          function esc(s) { return (s || "").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;"); }
          reviews.forEach(function (review) {
            const product = products.find(function (p) { return p.id === review.product_id; });
            const productName = esc(product ? product.name : "Product #" + review.product_id);
            const stars = "‚≠ê".repeat(Math.min(5, Math.max(0, review.rating || 0)));
            let imgSrc = "";
            if (review.images && review.images.length > 0) {
              imgSrc = review.images[0].indexOf("/") === 0 ? review.images[0] : "/static/" + review.images[0];
            } else if (product && product.image) {
              imgSrc = product.image.indexOf("/") === 0 ? product.image : "/static/" + product.image;
            }
            const imgTag = imgSrc ? '<img src="' + imgSrc.replace(/"/g, "&quot;") + '" alt="" onerror="this.style.display=\'none\'" />' : "";
            const contact = [];
            if (review.customer_phone) contact.push('<span>üìû ' + esc(review.customer_phone) + '</span>');
            if (review.customer_facebook) contact.push('<a href="' + (review.customer_facebook || "").replace(/"/g, "&quot;") + '" target="_blank" rel="noopener">FB</a>');
            if (review.customer_instagram) contact.push('<a href="' + (review.customer_instagram || "").replace(/"/g, "&quot;") + '" target="_blank" rel="noopener">IG</a>');
            const contactHtml = contact.length > 0 ? contact.join(" ") : "";
            const card = document.createElement("div");
            card.className = "product-card-work";
            var imgWrapAttrs = ' class="product-card-images review-card-image-wrap" data-review-id="' + review.id + '" data-customer-name="' + esc(review.customer_name || "").replace(/"/g, "&quot;") + '" data-rating="' + (review.rating || 0) + '" data-product-name="' + productName.replace(/"/g, "&quot;") + '" data-img-src="' + (imgSrc || "").replace(/"/g, "&quot;") + '" style="cursor:pointer" role="button" tabindex="0" aria-label="‡ªÄ‡∫ö‡∫¥‡ªà‡∫á/‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô"';
            card.innerHTML =
              '<div' + imgWrapAttrs + '><div class="product-card-img product-card-img-single">' + imgTag + '</div></div>' +
              '<div class="product-card-body"><div class="product-card-brand">' + productName + ' ‚Äì ' + esc(review.customer_name) + '</div>' +
              (contactHtml ? '<div class="product-card-contact">' + contactHtml + '</div>' : '') + '</div>' +
              '<div class="product-card-actions"><div class="price">' + stars + '</div>' +
              (review.comment ? '<span class="muted small">' + esc(review.comment) + '</span>' : '') + '</div>';
            reviewGrid.appendChild(card);
          });
          // ‡∫Å‡∫ª‡∫î‡∫Æ‡∫π‡∫ö‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÄ‡∫õ‡∫µ‡∫î modal ‡ªÄ‡∫ö‡∫¥‡ªà‡∫á/‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô
          reviewGrid.querySelectorAll(".review-card-image-wrap").forEach(function (el) {
            el.addEventListener("click", function () { openReviewDetailModal(el.dataset); });
            el.addEventListener("keydown", function (e) { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); openReviewDetailModal(el.dataset); } });
          });
        }
      } catch (e) {
        console.error("Error loading reviews:", e);
        if (reviewGrid) reviewGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: #f00; padding: 40px 0;">‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î‡ªÉ‡∫ô‡∫Å‡∫≤‡∫ô‡ªÇ‡∫´‡∫º‡∫î‡∫•‡∫µ‡∫ß‡∫¥‡∫ß</div>';
      }
    };

    var currentModalReviewId = null;
    var currentModalRating = 0;
    function openReviewDetailModal(data) {
      if (!data || !data.reviewId) return;
      currentModalReviewId = data.reviewId;
      currentModalRating = parseInt(data.rating, 10) || 0;
      var imgEl = document.getElementById("reviewDetailImage");
      var productEl = document.getElementById("reviewDetailProduct");
      var customerEl = document.getElementById("reviewDetailCustomer");
      var starsEl = document.getElementById("reviewDetailStars");
      var nameInput = document.getElementById("reviewDetailNameInput");
      var errorEl = document.getElementById("reviewDetailError");
      if (imgEl) imgEl.innerHTML = data.imgSrc ? '<img src="' + data.imgSrc + '" alt="" style="width:100%;height:100%;object-fit:cover" />' : "";
      if (productEl) productEl.textContent = data.productName || "";
      if (customerEl) customerEl.textContent = "‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤: " + (data.customerName || "");
      if (starsEl) starsEl.textContent = "‚≠ê".repeat(Math.min(5, Math.max(0, currentModalRating)));
      if (nameInput) nameInput.value = "";
      if (errorEl) { errorEl.style.display = "none"; errorEl.textContent = ""; }
      var starsInput = document.getElementById("reviewDetailStarsInput");
      if (starsInput) {
        starsInput.innerHTML = "";
        for (var i = 1; i <= 5; i++) {
          var btn = document.createElement("button");
          btn.type = "button";
          btn.className = "review-star-btn" + (i <= currentModalRating ? " active" : "");
          btn.textContent = i <= currentModalRating ? "‚òÖ" : "‚òÜ";
          btn.dataset.rating = i;
          (function (r) {
            btn.addEventListener("click", function () {
              currentModalRating = r;
              starsInput.querySelectorAll(".review-star-btn").forEach(function (b, j) {
                b.textContent = j + 1 <= r ? "‚òÖ" : "‚òÜ";
                b.classList.toggle("active", j + 1 <= r);
              });
              if (document.getElementById("reviewDetailStars")) document.getElementById("reviewDetailStars").textContent = "‚≠ê".repeat(r);
            });
          })(i);
          starsInput.appendChild(btn);
        }
      }
      document.getElementById("reviewDetailModal").style.display = "flex";
    }
    function closeReviewDetailModal() {
      document.getElementById("reviewDetailModal").style.display = "none";
      currentModalReviewId = null;
    }
    document.getElementById("reviewDetailModalClose").addEventListener("click", closeReviewDetailModal);
    document.getElementById("reviewDetailCancel").addEventListener("click", closeReviewDetailModal);
    var modalEl = document.getElementById("reviewDetailModal");
    if (modalEl) modalEl.querySelector(".review-detail-modal-backdrop").addEventListener("click", closeReviewDetailModal);
    document.getElementById("reviewDetailSave").addEventListener("click", function () {
      if (!currentModalReviewId) return;
      var nameInput = document.getElementById("reviewDetailNameInput");
      var errorEl = document.getElementById("reviewDetailError");
      var name = (nameInput && nameInput.value) ? nameInput.value.trim() : "";
      if (!name) {
        if (errorEl) { errorEl.textContent = "‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡ªÉ‡∫™‡ªà‡∫ä‡∫∑‡ªà‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô"; errorEl.style.display = "block"; }
        return;
      }
      if (errorEl) errorEl.style.display = "none";
      fetch("/api/reviews/" + currentModalReviewId, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ customer_name: name, rating: currentModalRating })
      }).then(function (r) { return r.json().then(function (data) {
        if (r.ok) {
          closeReviewDetailModal();
          if (window.loadReviewList) window.loadReviewList();
        } else {
          if (errorEl) { errorEl.textContent = data.error || "‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î"; errorEl.style.display = "block"; }
        }
      }); }).catch(function () {
        if (errorEl) { errorEl.textContent = "‡ªÄ‡∫ä‡∫∑‡ªà‡∫≠‡∫°‡∫ï‡ªç‡ªà‡∫•‡∫ª‡ªâ‡∫°‡ªÄ‡∫´‡∫º‡∫ß"; errorEl.style.display = "block"; }
      });
    });

    window.loadReviewList();
  </script>
</body>
</html>
